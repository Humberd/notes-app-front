parameters:
  runTests: 'true'
  nodeVersion: ''

steps:
  - script: |
      node -p "new Date().getTime()" > buildStartTime.txt
    displayName: Save build start time

  - task: NodeTool@0
    inputs:
      versionSpec: 12.12.0

  - task: Npm@1
    displayName: 'Install'
    inputs:
      command: custom
      customCommand: ci

  - task: Npm@1
    displayName: 'Build'
    inputs:
      command: custom
      customCommand: "run build:prod"

  - displayName: Save build end time
    script: |
      node -p "new Date().getTime()" > buildEndTime.txt

  - displayName: Save node_modules size
    script: |
      du -sb node_modules/ | awk '{printf $1}' > nodeModulesSize.txt

  - displayName: Save commit id
    script: |
      echo $BUILD_SOURCEVERSION > commitId.txt

  - displayName: Save build id
    script: |
      echo $BUILD_BUILDID > buildId.txt


  - task: CopyFiles@2
    inputs:
      SourceFolder: '$(System.DefaultWorkingDirectory)'
      Contents: |
        .azure/release-scripts/**/*
        dist/**/*
        buildStartTime.txt
        buildEndTime.txt
        nodeModulesSize.txt
        commitId.txt
        buildId.txt
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
